jBPM Dashboard & Human Tasks Console integration
=================================================

Please follow this steps in order to integrate the jbpm-console-ng with the Dashboard Builder.

* NOTE 1: the following procedure is for a JBoss standalone server, but it can easily be extended for other installation types.
* NOTE 2: If you only want to install the bam application, skip steps 2, 2.1, 2.2, 5.3, and 6.

1 Install a JBoss 7.1 server
---------------------------

1.1 Add the following additional configuration.
  Edit the <jboss_home>/bin/standalone.conf file and add the following line at the end of the file:

    JAVA_OPTS="$JAVA_OPTS -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false"

2 Deploy the JBPM console
---------------------------

Get the proper jbpm-console-ng application (e.g. jbpm-console-ng-jboss-as7.0.war) distribution file and deploy it in
the JBoss 7.1 server.

(You can find more information about how to build and configure this project in the following url: https://github.com/droolsjbpm/jbpm-console-ng)

In order to deploy the jbpm-console-ng you can use any of the JBoss deployment methods.
In the following lines we are going to use JBoss command line tooling.

Assuming <jboss_home> is the path to the given JBoss installation dir. (e.g. /opt/jboss-as-7.1.1.Final) execute the
following commands:

* 2.1 Start the JBoss server.
* 2.2 Open a terminal window and execute the following commands:

    $ cd <jboss_home>/bin
    $ ./jboss-cli.sh --connect --command="deploy <path_to_jbpm_console_file>"

    <path_to_jbpm_console_file>: is the local path to the jbpm console application war file.
    e.g. $ ./jboss-cli.sh --connect --command="deploy /home/myuser/myfiles/jbpm-console-ng-jboss-as7.0.war" )

3 Datasource creation
-------------------------------

The application is configured to use a data source defined in the JBoss server with the following
JNDI name: java:jboss/datasources/dashbuilderDS

The following lines gives you an example of how to create this datasource using the CLI commands, but you can use any
other method supported by the JBoss 7.1 server like the web console.

Create the H2 datasource to support the BAM application executing the following command.

    $ ./jboss-cli.sh --connect --file=<path_to_datasource_file>

    <path_to_datasource_file>: the file create-datasource.src file is provided with the distribution and has the following content (one line per command).

    /subsystem=datasources/data-source="dashbuilderDS":add(jndi-name="java:jboss/datasources/dashbuilderDS", driver-name="h2", connection-url="jdbc:h2:~/dashbuilder-ds", user-name="dashbuilder", password="dashbuilder")
    /subsystem=datasources/data-source=dashbuilderDS:enable

The create-datasource.src can be located in the following directory: builder/src/main/jbossas7/scripts.

NOTE: If you want to add the data source definition manually in the JBoss standalone.xml configuration file just copy
this xml fragment inside the <datasources> ... </datasources> definition section.

    <datasource jndi-name="java:jboss/datasources/dashbuilderDS" pool-name="dashbuilderDS" enabled="true">
        <connection-url>jdbc:h2:~/dashbuilder-ds</connection-url>
        <driver>h2</driver>
        <security>
            <user-name>dashbuilder</user-name>
            <password>dashbuilder</password>
        </security>
    </datasource>


NOTE: when the Dashboard Builder application starts for the first time it may take some minutes due to the database initialization procedure.
The configured database user must also have enough database grants to create the database objects.
Take in count that the H2 database downgrades the application performance compared with other databases like PostgreSQL,
MySQL, etc., normally used in production environments.

4 Deploy the application
--------------------------

Get the proper war file (e.g. dashbuilder-jboss-as7.0.war) distribution file and deploy it in the JBoss 7.1 server.

(You can find more information about how to generate installable artifacts at builder/README.md)

In order to deploy the application execute the following commands.

    $ cd <jboss_home>/bin
    $ ./jboss-cli.sh --connect --command="deploy <path_to_war_file>"

    <path_to_war_file>: is the local path to the application war file.
    e.g. $ ./jboss-cli.sh --connect --command="deploy /home/myuser/myfiles/dashbuilder-jboss-as7.0.war" )

5 Application configuration
----------------------------

In order to link the jBPM dashboard with the data generated by the jbpm-console-ng application the following configuration
must be done.

* 5.1 Log into the Dashboard Builder application typing the following url: http://localhost:8080/dashbuilder and the user/password
    root/root or demo/demo.

* 5.2 Create the external connection to access the processes data.

  Go to the menu option "Administration -> External connections" and create a new "Data Source" with the
  following parameters.

    Type: JNDI
    Name: JbpmData
    JNDI path: java:jboss/datasources/ExampleDS
    Test Query: select * from bamtasksummary

  Use the "Check DataSource" button to execute the test query and save the data source.

  NOTE: the jbpm-console-ng uses the java:jboss/datasources/ExampleDS datasource. This data source
  is intended for development/demo purposes, if you have configured any other data source for the jbpm-console-ng
  application you must use this name here)

* 5.3 Adjust the data providers related to the processes.

  Go to the menu option "Administration -> Data providers" and you will se the following three pre-installed SQL data providers.

  * jBPM Count Processes
  * jBPM Process Summary
  * jBPM Task Summary

  Using the "Edit data provider" action, edit the configuration for each of the three data providers and select the
  recently created "JbpmData" as the "Datasource to use". (use the save button to change the configuration)

6 jBPM Dashboard
----------------------------

Once the three datasources has been properly configured, the application is ready to display the information for the processes
instantiated in the jbpm-console-ng.

The jBPM Process Dashboard can be accessed in two ways:

* As root, by selecting the jBPM Dashboard workspace at the top administration toolbar, or
* Typing the following url <code>http://localhost:8080/dashbuilder/workspace/jbpm-dashboard</code>